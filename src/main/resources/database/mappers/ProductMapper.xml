<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.iu.boot3.product.ProductMapper">
    
    <insert id="add" parameterType="ProductVO" useGeneratedKeys="true" keyProperty="productNum">
    INSERT INTO PRODUCT(PRODUCTNUM, PRODUCTNAME, PRODUCTPRICE, PRODUCTCOUNT, PRODUCTDETAIL)
    VALUES (#{productNum}, #{productName}, #{productPrice}, #{productCount}, #{productDetail})   
    </insert>
    
    <select id="list" parameterType="Pager" resultMap="listResult">   
    SELECT P.*, F.*
	FROM
	(
	SELECT
	*
	FROM PRODUCT
	WHERE PRODUCTNUM>0
	ORDER BY PRODUCTNUM DESC
	LIMIT #{startRow}, #{perPage}
	) P
	LEFT JOIN
	PRODUCTFILES F
	USING(PRODUCTNUM)
    </select>
    
    <resultMap type="ProductVO" id="listResult">
    <id column="productNum" property="productNum"/>
    <result column="productName" property="productName"/>
    <result column="productPrice" property="productPrice"/>
    <result column="productCount" property="productCount"/>
    <result column="productDetail" property="productDetail"/>
    
    <collection property="productFilesVOs" javaType="java.util.List" ofType="ProductFilesVO">
    <id column="fileNum" property="fileNum"/>
    <result column="productNum" property="productNum"/>
    <result column="fileName" property="fileName"/>
    <result column="oriName" property="oriName"/>
    </collection>
    </resultMap>
    
    <insert id="fileAdd" parameterType="ProductFilesVO">
 		INSERT INTO PRODUCTFILES
 		VALUES(NULL, #{productNum}, #{fileName}, #{oriName})
 	</insert>
   
    </mapper>